name: Deploy Backend

on:
  push:
    branches:
      - main


jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: SSH and Deploy
      run: |
        # Install sshpass to securely pass the SSH password
        sudo apt-get install -y sshpass

        # SSH into the server
        sshpass -p 'UtOKdIDiA4wrEVK' ssh -o StrictHostKeyChecking=no ubuntu@3.95.189.168 << 'ENDSSH'
          # Navigate to the project directory
          cd /var/www/Greenback-Claims

          # Pull the latest changes
          sudo git pull origin main

          # Navigate to the server directory
          cd server

          # Stop the current PM2 process
          sudo pm2 delete index.js --name "node"

          # Start the new PM2 process
          sudo pm2 start index.js --name "node"
        ENDSSH
        
